const chai = require('chai');
const vinParser = require('../../../../common/lib/garagescore/vehicle/vin-parser');

const expect = chai.expect;
chai.should();

/*
 * Extract model and make from vin
 */

describe('Test VIN parser', () => {
  it('Mercedes', function test(done) {
    const tests = [
      ['WDD2040071A146604', 'Mercedes-Benz', 'C 200 CDI'],
      ['WDC1668241A442194', 'Mercedes-Benz', 'GLS 350 BLUETEC 4MA'],
      ['WDD2050401F068199', 'Mercedes-Benz', 'C 180 BERLINA'],
      ['WDB2030061A157882', 'Mercedes-Benz', 'C 220 CDI'],
      ['WDD2050041R137373', 'Mercedes-Benz', 'C 220 BLUETEC SEDAN'],
      ['WDF63970113047273', 'Mercedes-Benz', '126 VITO L COMPACTO'],
      ['WDB2110221A826373', 'Mercedes-Benz', 'E 320 CDI'],
      ['WDC1660241A079501', 'Mercedes-Benz', 'GLE 350 D 4M'],
      ['WDB2030081A605943', 'Mercedes-Benz', 'C 220 CDI'],
      ['WDF63981113416147', 'Mercedes-Benz', '2.0 CDI TREND COMPACTO'],
    ];

    for (const exp of tests) {
      const res = vinParser.parse(exp[0]);
      expect(res.make).equal(exp[1], exp[0]);
      expect(res.model).equal(exp[2], exp[0]);
    }

    const rate = vinParser.successRate(
      [
        'WDC1569431J525640',
        'WDD2040491A473732',
        'WDC2539051F000687',
        'WDD2050041R082183',
        'WDD2050041R082183',
        'WDD2452321J536479',
        'WDD2452321J536479',
        'WDD1770871N003827',
        'WDD2130041A085521',
        'WDB2110201B282553',
        'WDB2110201B282553',
        'WDD2120941B263408',
        'WDD2050041R282804',
        'WDD2050041R282804',
        'WDD2042081F287899',
        'WDD2042081F287899',
        'WDD1690321J042318',
        'WDC2533461F470832',
        'WDD2130041A004291',
        'WDD2050041F034479',
        'WDD2050041F034479',
        'WDC2049841G171832',
        'WDC2049841G171832',
        'WDD2040021A306648',
        'WDD1760121J572817',
        'WDD2221211A359884',
        'WDD2221211A359884',
        'WDD2452321J536479',
        'WDD2040021A868761',
        'WDD2040021A868761',
        'WDD1760001J082890',
        'WDC2539051F469611',
        'WDD2052041F307748',
        'WDC2049841G087208',
        'WDC1569031J523908',
        'WDC2539461F233995',
        'WDD1770031N011202',
        'WDB2201651A020155',
        'WDD2050041R384896',
        'WDC2539461F313699',
        'WDC2539091F179600',
        'WDD1760421J727847',
        'WDB2094541T068014',
        'WDD1690311J572146',
        'WDD2210221A200635',
        'WDC1660241A084164',
        'WDC1660241A084164',
        'WDC2539091F179600',
        'WME4530421Y047526',
        'WME4533911K328745',
        'WME4533441K092889',
        'WME4530911Y165894',
        'WME4533911K309942',
        'WME4530911Y130827',
        'WME4533441K286244',
        'WME4503431H151852',
        'WME4533441K055060',
        'WME4533421K084598',
        'WDD2042011G027292',
        'WDD2462081N224794',
        'WDD2050041R285018',
        'WDD2043021F687177',
        'WDD1173441N094976',
        'WDD2052041F641766',
        'WDB2110201B088767',
        'WDB2110201B034959',
        'WDC1641221A454188',
        'WDB9331631L050609',
        'WDD1690311J275309',
        'WDD2040021A536122',
        'WDD1760081J690125',
        'WDB2110201A899748',
        'WDB1680081J277876',
        'WDB2100161A978510',
        'WDC2539051F456606',
        'WDB4633231X133405',
        'WDF44760313513809',
        'WDB9036621R661293',
        'WDD1173031N196670',
        'WDB2110201A989160',
        'WDB2030081A700922',
        'WDD2120051A943281',
        'WDD1760081J501188',
        'WDB2110081B327830',
        'WDD2040021A678474',
        'WDD1760121J116783',
        'WDD1760121J116783',
        'WDD2040491A663763',
        'WDD1770871N011688',
        'WDD1770871N011688',
        'WDC2049841F671872',
        'WDC2539091F580592',
        'WDF63981513806533',
        'WDF44770313261003',
        'WDF44770313261003',
        'WDD1173431N099536',
        'WDD1760081J618765',
        'WDB9076331P054968',
        'WDF44781313005049',
        'WDC1660041A950033',
        'WDD2122021A639428',
        'WDD2040021A435315',
        'WDD2462001J048917',
        'WDD2130041A520034',
        'WDD1770031J049233',
        'WDD2462421J331959',
        'WDC2539091F123142',
        'WDC2539091F123142',
        'WDC1569031J207526',
        'WDC1660041A579118',
        'WDD2052771F857548',
        'WDD2052041F397845',
        'WDC2923241A128319',
        'WDD1770031N019505',
        'WDF44770113141121',
        'WDD2462081J485220',
        'WDC2923241A145453',
        'WDF44781313385105',
        'WDD2052041F321663',
        'WDD1770031N053882',
        'WDD1770031N015506',
        'WDD2452071J740274',
        'WDF44770113319053',
        'WDF44770113319053',
      ] /* , (fail) => { console.log(`Parse failed: ${fail}`); }*/
    );
    expect(rate > 0.85).to.be.true;
    done();
  });
});
